<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Sinopia made Cozy</title>
</head>
<body>
    <h1>Sinopia status</h1>
    <br/>
    <a href="#" class="enable">Click here to <span class="status"></span></a>
    <br/>
    <b>Original registry</b>
    <input type="text" name="originalRegistry" />
    <button name="change" style="visibility: hidden">Change</button>

<script src="jquery-2.1.3.min.js"></script>
<script>
    (function(){
        var updateStatus = function(enabled){
            if (enabled) {
                $('.status').html('disable')
            } else {
                $('.status').html('enable')
            }
        };
        $.get('status', function(d){
            updateStatus(d.enabled);
        });
        var working = false;
        $('.enable').on('click', function(){
            working = true;
            var enabled = $('.status').html() == 'disable';
            if (enabled) {
                $.get('disable', function(d){
                    updateStatus(d.enabled);
                });
            } else {
                $.get('enable', function(d){
                    updateStatus(d.enabled);
                });
            }
            return false;
        });

        var originalRegistry;
        $.get('original_registry', function(d){
            originalRegistry = d.original_registry;
            $('input[name="originalRegistry"]').val(originalRegistry);
        });
        $('input[name="originalRegistry"]').on('keyup' , function(){
            if( $(this).val() !== originalRegistry ){
                $('button[name="change"]').css('visibility','visible');
            } else {
                $('button[name="change"]').css('visibility','hidden');
            }
        });
        $('button[name="change"]').on('click', function(){
            var v = $('input[name="originalRegistry"]').val();
            $.post('original_registry',{registry:v}, function(d){
                originalRegistry = d;
                $('button[name="change"]').css('visibility','hidden');
            });
        });
    })();
</script>
</body>
</html>